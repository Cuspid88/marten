---
title: Marten 0.3.0 release notes
pagination_prev: null
pagination_next: null
---

_Under development._

## Requirements and compatibility

Crystal 1.6, 1.7, and 1.8.

## New features

### Support for streaming responses

It is now possible to generate streaming responses from iterators of strings easily by leveraging the [`Marten::HTTP::Response::Streaming`](pathname:///api/dev/Marten/HTTP/Response/Streaming.html) class or the [`#respond`](pathname:///api/dev/Marten/Handlers/Base.html#respond(streamed_content%3AIterator(String)%2Ccontent_type%3DHTTP%3A%3AResponse%3A%3ADEFAULT_CONTENT_TYPE%2Cstatus%3D200)-instance-method) helper method. This can be beneficial if you intend to generate lengthy responses or responses that consume excessive memory (a classic example of this is the generation of large CSV files).

Please refer to [Streaming responses](../../handlers-and-http/introduction#streaming-responses) to learn more about this new capability.

### Caching

Marten now lets you interact with a global cache store that allows interacting with an underlying cache system and performing basic operations such as fetching cached entries, writing new entries, etc. By using caching, you can save the result of expensive operations so that you don't have to perform them for every request.

The global cache can be accessed by leveraging the [`Marten#cache`](pathname:///api/dev/Marten.html#cache%3ACache%3A%3AStore%3A%3ABase-class-method) method. Here are a few examples on how to perform some basic caching operations:

```crystal
# Fetching an entry from the cache.
Marten.cache.fetch("mykey", expires_in: 4.hours) do
  "myvalue"
end

# Reading from the cache.
Marten.cache.read("unknown") # => nil
Marten.cache.read("mykey") # => "myvalue"
Marten.cache.exists?("mykey") => true

# Writing to the cache.
Marten.cache.write("foo", "bar", expires_in: 10.minutes) => true
```

Marten's caching leverages a [cache store mechanism](../../caching/introduction#configuration-and-cache-stores). By default, Marten uses an in-memory cache (instance of [`Marten::Cache::Store::Memory`](pathname:///api/dev/Marten/Cache/Store/Memory.html)) and other [third-party stores](../../caching/reference/stores#other-stores) can be installed depending on your caching requirements (eg. Memcached, Redis).

Marten's new caching capabilities are not only limited to its standard cache functionality. They can also be effectively utilized via the newly introduced [template fragment caching](../../caching/introduction#template-fragment-caching) feature, made possible by the [`cache`](../../templates/reference/tags#cache) template tag. With this feature, specific parts of your [templates](../../templates) can now be cached with ease.

Please refer to the [Caching](../../caching) to learn more about these new capabilities.

### Duration field for models and schemas

It is now possible to define `duration` fields in [models](../../models-and-databases/reference/fields#duration) and [schemas](../../schemas/reference/fields#duration). These allow you to easily persist valid durations (that map to [`Time::Span`](https://crystal-lang.org/api/Time/Span.html) objects in Crystal) in your models but also to expect valid durations in data validated through the use of schemas.

For example:

```crystal
class Recipe < Marten::Model
  field :id, :big_int, primary_key: true, auto: true
  # Other fields...
  field :fridge_time, :duration, blank: true, null: true
end
```

### Minor features

#### Models and databases

* New [`#get_or_create`](../../models-and-databases/reference/query-set#get_or_create) / [`#get_or_create!`](../../models-and-databases/reference/query-set#get_or_create-1) methods were added to query sets in order to allow easily retrieving a model record matching a given set of filters or creating a new one if no record is found.
* [`string`](../../models-and-databases/reference/fields#string) fields now support a `min_size` option allowing to validate the minimum size of persisted string field values.
* A new [`#includes?`](../../models-and-databases/reference/query-set#includes) method was added to query sets in order easily perform membership checks without loading the entire list of records targeted by a given query set.
* Alternative [`#exists?`](../../models-and-databases/reference/query-set#exists) methods were added to query sets in order to allow specifying additional filters to use as part of existence checks.
* Marten migrations are now optimized to prevent possible issues with circular dependencies within added or deleted tables

#### Handlers and HTTP

* A new [`Marten::Middleware::AssetServing`](../../handlers-and-http/reference/middlewares#asset-serving-middleware) middleware was introduced to make it easy to serve collected assets in situations where it is not possible to easily configure a web server (such as [Nginx](https://nginx.org)) or a third-party service (like Amazon's S3 or GCS) to serve assets directly.
* The [`Marten::Handlers::RecordList`](../../handlers-and-http/reference/generic-handlers#listing-records) generic record now provides the ability to specify a custom [query set](../../models-and-databases/queries) instead of a model class. This can be achieved through the use of the [`#queryset`](pathname:///api/dev/Marten/Handlers/RecordListing.html#queryset(queryset)-macro) macro.

#### Templates

* A [`join`](../../templates/reference/filters#join) template filter was introduced to allow converting enumerable template values into a string separated by a separator value.
* A [`split`](../../templates/reference/filters#split) template filter was introduced to allow converting a string into an array of elements.

#### Development

* [`Marten::HTTP::Errors::SuspiciousOperation`](pathname:///api/dev/Marten/HTTP/Errors/SuspiciousOperation.html) exceptions are now showcased using the debug internal error page handler to make it easier to diagnose errors such as unexpected host errors (which result from a missing host value in the [`allowed_hosts`](../../development/reference/settings#allowedhosts) setting).
* [`Marten#setup`](pathname:///api/dev/Marten.html#setup-class-method) now raises.[`Marten::Conf::Errors::InvalidConfiguration`](pathname:///api/dev/Marten/Conf/Errors/InvalidConfiguration.html) exceptions when a configured database involves a backend that is not installed (eg. a MySQL database configured without `crystal-lang/crystal-mysql` installed and required).
* The [`new`](../../development/reference/management-commands#new) management command now automatically creates a [`.editorconfig`](https://editorconfig.org) file for new projects.
* A new [`root_path`](../../development/reference/settings#root_path) setting was introduced to make it possible to configure the actual location of the project sources in your system. This is especially useful when deploying projects that have been compiled in a different location from their final destination, which can happen on platforms like Heroku. By setting the root path, you can ensure that your application can find all necessary project sources, as well as other files like locales, assets, and templates.
* A new `--plan` option was added to the [`migrate`](../../development/reference/management-commands#migrate) management command in order to provide a comprehensive overview of the operations that will be performed by the applied or unapplied migrations.

#### Deployment

* A new guide was added in order to document [how to deploy on Heroku](../../deployment/how-to/deploy-to-heroku).

## Backward incompatible changes

### Handlers and HTTP

* [Custom route parameter](../../handlers-and-http/how-to/create-custom-route-parameters) must now implement a [`#regex`](pathname:///api/dev/Marten/Routing/Parameter/Base.html#regex%3ARegex-instance-method) method and can no longer rely on a `#regex` macro to generate such method.
* The generic handlers that used to require the use of a `#model` class method now leverage a dedicated macro instead. This is to make handlers that inherit from generic handler classes more type-safe when it comes to manipulating model records.
* The generic handlers that used to require the use of a `#schema` class method now leverage a dedicated macro instead. This is to make handlers that inherit from generic handler classes more type-safe when it comes to manipulating schema instances.
